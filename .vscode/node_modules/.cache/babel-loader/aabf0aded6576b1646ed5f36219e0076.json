{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\teres\\\\Desktop\\\\RastroIO\\\\src\\\\pages\\\\Tracking\\\\index.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { FiArchive, FiCheckSquare, FiMenu } from 'react-icons/fi';\nimport { useHistory, useParams } from 'react-router-dom';\nimport axios from 'axios';\nimport SideMenu from '../../components/SideMenu';\nimport { usePackages } from '../../hooks/packages';\nimport { useTheme } from '../../hooks/theme';\nimport api from '../../services/api';\nimport { Container, Header, Content, MenuToggleButton, OptionsContainer, ReceivedButton, ArchiveButton, TrackingContainer, MainStatus, Status, Row } from './styles';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Track = () => {\n  _s();\n\n  const {\n    theme\n  } = useTheme();\n  const sideMenuRef = useRef(null);\n  const toggleMenu = useCallback(() => {\n    var _sideMenuRef$current;\n\n    (_sideMenuRef$current = sideMenuRef.current) === null || _sideMenuRef$current === void 0 ? void 0 : _sideMenuRef$current.toggleMenu();\n  }, []);\n  const {\n    update,\n    findById,\n    moveTo,\n    getPackageKey,\n    packages\n  } = usePackages();\n  const {\n    replace\n  } = useHistory();\n  const {\n    id\n  } = useParams();\n  const [events, setEvents] = useState([]);\n  const [category, setCategory] = useState('');\n  const eventsHistory = useMemo(() => events.slice(1), [events]);\n  const lastEvent = useMemo(() => events[0], [events]);\n  const receivedButtonHandle = useCallback(() => {\n    moveTo(id, 'delivered');\n    replace('/');\n  }, [id, moveTo, replace]);\n  const archiveButtonHandle = useCallback(() => {\n    moveTo(id, 'archived');\n    replace('/');\n  }, [id, moveTo, replace]);\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      const packageCategory = getPackageKey(id);\n\n      if (packageCategory) {\n        setCategory(packageCategory);\n      }\n    }, 100);\n    return () => clearTimeout(timer);\n  }, [packages, getPackageKey, id]);\n  useEffect(() => {\n    const packageData = findById(id);\n\n    if (packageData === null || packageData === void 0 ? void 0 : packageData.hasUpdate) {\n      update({ ...packageData,\n        hasUpdate: false\n      });\n    }\n\n    if (category === 'archived' || category === 'delivered') {\n      if (packageData === null || packageData === void 0 ? void 0 : packageData.events) {\n        setEvents(packageData.events);\n      }\n\n      return;\n    }\n\n    if ((packageData === null || packageData === void 0 ? void 0 : packageData.updated_at) && packageData.events.length) {\n      const lastUpdate = new Date(packageData.updated_at).getTime();\n      const now = new Date().getTime();\n\n      if (now - lastUpdate < 300000) {\n        setEvents(packageData.events);\n        return;\n      }\n    }\n\n    const source = axios.CancelToken.source();\n\n    const fetchData = async () => {\n      try {\n        if (packageData) {\n          const response = await api.post('rastreio', {\n            code: packageData.code,\n            type: 'LS'\n          }, {\n            cancelToken: source.token\n          });\n\n          if (response.data.objeto && Array.isArray(response.data.objeto) && !response.data.objeto[0].categoria.includes('ERRO')) {\n            setEvents(response.data.objeto[0].evento);\n            update({ ...packageData,\n              events: response.data.objeto[0].evento,\n              updated_at: new Date().toISOString()\n            });\n          }\n        }\n      } catch (e) {\n        if (axios.isCancel(e)) {\n          return;\n        }\n\n        const packageData = findById(id);\n\n        if (packageData === null || packageData === void 0 ? void 0 : packageData.events) {\n          setEvents(packageData.events);\n        }\n      }\n    };\n\n    fetchData();\n    return () => source.cancel('Request cancelada');\n  }, [findById, id, update, getPackageKey, category]);\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [/*#__PURE__*/_jsxDEV(SideMenu, {\n      ref: sideMenuRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Content, {\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        children: /*#__PURE__*/_jsxDEV(MenuToggleButton, {\n          onClick: toggleMenu,\n          children: /*#__PURE__*/_jsxDEV(FiMenu, {\n            size: 24,\n            color: theme.colors.text_primary\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }, this), events.length > 0 && /*#__PURE__*/_jsxDEV(TrackingContainer, {\n        children: [/*#__PURE__*/_jsxDEV(OptionsContainer, {\n          children: [category === 'tracking' && /*#__PURE__*/_jsxDEV(ReceivedButton, {\n            onClick: receivedButtonHandle,\n            children: [/*#__PURE__*/_jsxDEV(FiCheckSquare, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 191,\n              columnNumber: 19\n            }, this), \"Entregue\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 17\n          }, this), category !== 'archived' && /*#__PURE__*/_jsxDEV(ArchiveButton, {\n            onClick: archiveButtonHandle,\n            children: [/*#__PURE__*/_jsxDEV(FiArchive, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 197,\n              columnNumber: 19\n            }, this), \"Arquivar\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(MainStatus, {\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            children: \"\\xDAltimo Status do Objeto\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 203,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Row, {\n            children: [\"Status: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: lastEvent.descricao\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 205,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Row, {\n            children: [\"Data: \", lastEvent.data, \" | Hora: \", lastEvent.hora]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Row, {\n            children: [\"Local: \", lastEvent.unidade.tipounidade, \" -\", ' ', lastEvent.unidade.cidade, \" / \", lastEvent.unidade.uf]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 15\n          }, this), lastEvent.destino && /*#__PURE__*/_jsxDEV(Row, {\n            children: [\"Destino: \", lastEvent.destino[0].local, \" -\", ' ', lastEvent.destino[0].cidade, \" / \", lastEvent.destino[0].uf]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 13\n        }, this), eventsHistory.map(event => /*#__PURE__*/_jsxDEV(Status, {\n          children: [/*#__PURE__*/_jsxDEV(Row, {\n            children: [\"Status: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: event.descricao\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 27\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Row, {\n            children: [\"Data: \", event.data, \" | Hora: \", event.hora]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Row, {\n            children: [\"Local: \", event.unidade.tipounidade, \" - \", event.unidade.cidade, \" /\", ' ', event.unidade.uf]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 229,\n            columnNumber: 17\n          }, this), event.destino && /*#__PURE__*/_jsxDEV(Row, {\n            children: [\"Destino: \", event.destino[0].local, \" -\", ' ', event.destino[0].cidade, \" / \", event.destino[0].uf]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 19\n          }, this)]\n        }, event.criacao, true, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 15\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 178,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Track, \"MKj+QhGRJT+QFwNM4GJPO7LUOw8=\", false, function () {\n  return [useTheme, usePackages, useHistory, useParams];\n});\n\n_c = Track;\nexport default Track;\n\nvar _c;\n\n$RefreshReg$(_c, \"Track\");","map":{"version":3,"sources":["C:/Users/teres/Desktop/RastroIO/src/pages/Tracking/index.tsx"],"names":["React","useCallback","useEffect","useMemo","useRef","useState","FiArchive","FiCheckSquare","FiMenu","useHistory","useParams","axios","SideMenu","usePackages","useTheme","api","Container","Header","Content","MenuToggleButton","OptionsContainer","ReceivedButton","ArchiveButton","TrackingContainer","MainStatus","Status","Row","Track","theme","sideMenuRef","toggleMenu","current","update","findById","moveTo","getPackageKey","packages","replace","id","events","setEvents","category","setCategory","eventsHistory","slice","lastEvent","receivedButtonHandle","archiveButtonHandle","timer","setTimeout","packageCategory","clearTimeout","packageData","hasUpdate","updated_at","length","lastUpdate","Date","getTime","now","source","CancelToken","fetchData","response","post","code","type","cancelToken","token","data","objeto","Array","isArray","categoria","includes","evento","toISOString","e","isCancel","cancel","colors","text_primary","descricao","hora","unidade","tipounidade","cidade","uf","destino","local","map","event","criacao"],"mappings":"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","sourcesContent":["import React, {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from 'react';\r\nimport { FiArchive, FiCheckSquare, FiMenu } from 'react-icons/fi';\r\nimport { useHistory, useParams } from 'react-router-dom';\r\n\r\nimport axios from 'axios';\r\n\r\nimport SideMenu from '../../components/SideMenu';\r\nimport { usePackages } from '../../hooks/packages';\r\nimport { useTheme } from '../../hooks/theme';\r\nimport api from '../../services/api';\r\n\r\nimport {\r\n  Container,\r\n  Header,\r\n  Content,\r\n  MenuToggleButton,\r\n  OptionsContainer,\r\n  ReceivedButton,\r\n  ArchiveButton,\r\n  TrackingContainer,\r\n  MainStatus,\r\n  Status,\r\n  Row,\r\n} from './styles';\r\n\r\ninterface SideMenuRef {\r\n  toggleMenu(): void;\r\n}\r\n\r\ninterface RouteParams {\r\n  id: string;\r\n}\r\n\r\ninterface AxiosTrackResponse {\r\n  objeto: [\r\n    {\r\n      categoria: string;\r\n      evento: TrackEvent[];\r\n    },\r\n  ];\r\n}\r\n\r\ninterface TrackEvent {\r\n  data: string;\r\n  hora: string;\r\n  descricao: string;\r\n  criacao: string;\r\n  destino?: [\r\n    {\r\n      local: string;\r\n      cidade: string;\r\n      uf: string;\r\n    },\r\n  ];\r\n  unidade: {\r\n    tipounidade: string;\r\n    cidade: string;\r\n    uf: string;\r\n  };\r\n}\r\n\r\nconst Track: React.FC = () => {\r\n  const { theme } = useTheme();\r\n\r\n  const sideMenuRef = useRef<SideMenuRef>(null);\r\n\r\n  const toggleMenu = useCallback(() => {\r\n    sideMenuRef.current?.toggleMenu();\r\n  }, []);\r\n\r\n  const { update, findById, moveTo, getPackageKey, packages } = usePackages();\r\n  const { replace } = useHistory();\r\n\r\n  const { id } = useParams<RouteParams>();\r\n\r\n  const [events, setEvents] = useState<TrackEvent[]>([]);\r\n  const [category, setCategory] = useState('');\r\n\r\n  const eventsHistory = useMemo(() => events.slice(1), [events]);\r\n  const lastEvent = useMemo(() => events[0], [events]);\r\n\r\n  const receivedButtonHandle = useCallback(() => {\r\n    moveTo(id, 'delivered');\r\n    replace('/');\r\n  }, [id, moveTo, replace]);\r\n\r\n  const archiveButtonHandle = useCallback(() => {\r\n    moveTo(id, 'archived');\r\n    replace('/');\r\n  }, [id, moveTo, replace]);\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      const packageCategory = getPackageKey(id);\r\n\r\n      if (packageCategory) {\r\n        setCategory(packageCategory);\r\n      }\r\n    }, 100);\r\n\r\n    return () => clearTimeout(timer);\r\n  }, [packages, getPackageKey, id]);\r\n\r\n  useEffect(() => {\r\n    const packageData = findById(id);\r\n\r\n    if (packageData?.hasUpdate) {\r\n      update({ ...packageData, hasUpdate: false });\r\n    }\r\n\r\n    if (category === 'archived' || category === 'delivered') {\r\n      if (packageData?.events) {\r\n        setEvents(packageData.events);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (packageData?.updated_at && packageData.events.length) {\r\n      const lastUpdate = new Date(packageData.updated_at).getTime();\r\n      const now = new Date().getTime();\r\n\r\n      if (now - lastUpdate < 300000) {\r\n        setEvents(packageData.events);\r\n        return;\r\n      }\r\n    }\r\n\r\n    const source = axios.CancelToken.source();\r\n\r\n    const fetchData = async () => {\r\n      try {\r\n        if (packageData) {\r\n          const response = await api.post<AxiosTrackResponse>(\r\n            'rastreio',\r\n            {\r\n              code: packageData.code,\r\n              type: 'LS',\r\n            },\r\n            { cancelToken: source.token },\r\n          );\r\n\r\n          if (\r\n            response.data.objeto &&\r\n            Array.isArray(response.data.objeto) &&\r\n            !response.data.objeto[0].categoria.includes('ERRO')\r\n          ) {\r\n            setEvents(response.data.objeto[0].evento);\r\n            update({\r\n              ...packageData,\r\n              events: response.data.objeto[0].evento,\r\n              updated_at: new Date().toISOString(),\r\n            });\r\n          }\r\n        }\r\n      } catch (e) {\r\n        if (axios.isCancel(e)) {\r\n          return;\r\n        }\r\n        const packageData = findById(id);\r\n\r\n        if (packageData?.events) {\r\n          setEvents(packageData.events);\r\n        }\r\n      }\r\n    };\r\n    fetchData();\r\n\r\n    return () => source.cancel('Request cancelada');\r\n  }, [findById, id, update, getPackageKey, category]);\r\n\r\n  return (\r\n    <Container>\r\n      <SideMenu ref={sideMenuRef} />\r\n      <Content>\r\n        <Header>\r\n          <MenuToggleButton onClick={toggleMenu}>\r\n            <FiMenu size={24} color={theme.colors.text_primary} />\r\n          </MenuToggleButton>\r\n        </Header>\r\n        {events.length > 0 && (\r\n          <TrackingContainer>\r\n            <OptionsContainer>\r\n              {category === 'tracking' && (\r\n                <ReceivedButton onClick={receivedButtonHandle}>\r\n                  <FiCheckSquare />\r\n                  Entregue\r\n                </ReceivedButton>\r\n              )}\r\n              {category !== 'archived' && (\r\n                <ArchiveButton onClick={archiveButtonHandle}>\r\n                  <FiArchive />\r\n                  Arquivar\r\n                </ArchiveButton>\r\n              )}\r\n            </OptionsContainer>\r\n            <MainStatus>\r\n              <h1>Último Status do Objeto</h1>\r\n              <Row>\r\n                Status: <strong>{lastEvent.descricao}</strong>\r\n              </Row>\r\n              <Row>\r\n                Data: {lastEvent.data} | Hora: {lastEvent.hora}\r\n              </Row>\r\n              <Row>\r\n                Local: {lastEvent.unidade.tipounidade} -{' '}\r\n                {lastEvent.unidade.cidade} / {lastEvent.unidade.uf}\r\n              </Row>\r\n              {lastEvent.destino && (\r\n                <Row>\r\n                  Destino: {lastEvent.destino[0].local} -{' '}\r\n                  {lastEvent.destino[0].cidade} / {lastEvent.destino[0].uf}\r\n                </Row>\r\n              )}\r\n            </MainStatus>\r\n            {eventsHistory.map(event => (\r\n              <Status key={event.criacao}>\r\n                <Row>\r\n                  Status: <strong>{event.descricao}</strong>\r\n                </Row>\r\n                <Row>\r\n                  Data: {event.data} | Hora: {event.hora}\r\n                </Row>\r\n                <Row>\r\n                  Local: {event.unidade.tipounidade} - {event.unidade.cidade} /{' '}\r\n                  {event.unidade.uf}\r\n                </Row>\r\n                {event.destino && (\r\n                  <Row>\r\n                    Destino: {event.destino[0].local} -{' '}\r\n                    {event.destino[0].cidade} / {event.destino[0].uf}\r\n                  </Row>\r\n                )}\r\n              </Status>\r\n            ))}\r\n          </TrackingContainer>\r\n        )}\r\n      </Content>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Track;\r\n"]},"metadata":{},"sourceType":"module"}